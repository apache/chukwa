~~ Licensed to the Apache Software Foundation (ASF) under one or more
~~ contributor license agreements.  See the NOTICE file distributed with
~~ this work for additional information regarding copyright ownership.
~~ The ASF licenses this file to You under the Apache License, Version 2.0
~~ (the "License"); you may not use this file except in compliance with
~~ the License.  You may obtain a copy of the License at
~~
~~     http://www.apache.org/licenses/LICENSE-2.0
~~
~~ Unless required by applicable law or agreed to in writing, software
~~ distributed under the License is distributed on an "AS IS" BASIS,
~~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
~~ See the License for the specific language governing permissions and
~~ limitations under the License.
~~
Apache Chukwa Quick Start Guide

Purpose

  Apache Chukwa is a system for large-scale reliable log collection and processing with Hadoop. Apache Chukwa design overview discusses the overall architecture of Apache Chukwa. You should read that document before this one. The purpose of this document is to help you install and configure Apache Chukwa.


Pre-requisites

  Apache Chukwa should work on any POSIX platform, but GNU/Linux is the only production platform that has been tested extensively. Apache Chukwa has also been used successfully on Mac OS X, which several members of the Apache Chukwa team use for development.

  Software requirements are Java 1.6 or better, ZooKeeper {{${zookeeperVersion}}}, HBase {{${hbaseVersion}}} and Hadoop {{${hadoopVersion}}}.

  Apache Chukwa cluster management scripts rely on ssh; these scripts, however, are not required if you have some alternate mechanism for starting and stopping daemons.


Installing Apache Chukwa

  A minimal Apache Chukwa deployment has five components:

  * A Apache Hadoop and Apache HBase cluster on which Apache Chukwa will process data (referred to as the Chukwa cluster). 
  
  * One or more agent processes, that send monitoring data to Apache HBase. The nodes with active agent processes are referred to as the monitored source nodes.
  
  * Solr Cloud cluster which Apache Chukwa will store indexed log files.

  * Data analytics script, summarize Hadoop Cluster Health.

  * HICC, Apache Chukwa visualization tool.

[]

[./images/chukwa_architecture.png] Apache Chukwa ${VERSION} Architecture 

First Steps

  * Obtain a copy of Apache Chukwa. You can find the latest release on the Apache Chukwa {{{http://www.apache.org/dyn/closer.cgi/chukwa/}release page}} (or alternatively check the source code out from SCM).

  * Un-tar the release, via tar xzf.

  * Make sure a copy of Apache Chukwa is available on each node being monitored.

  * We refer to the directory containing Apache Chukwa as CHUKWA_HOME. It may be useful to set CHUKWA_HOME explicitly in your environment for ease of use.

Setting Up Apache Chukwa Cluster

* Configure Hadoop and HBase

  [[1]] Copy Apache Chukwa files to Hadoop and HBase directories:

---
cp $CHUKWA_HOME/etc/chukwa/hadoop-log4j.properties $HADOOP_CONF_DIR/log4j.properties
cp $CHUKWA_HOME/etc/chukwa/hadoop-metrics2.properties $HADOOP_CONF_DIR/hadoop-metrics2.properties
cp $CHUKWA_HOME/share/chukwa/chukwa-${VERSION}-client.jar $HADOOP_HOME/share/hadoop/common/lib
cp $CHUKWA_HOME/share/chukwa/lib/json-simple-${json-simpleVersion}.jar $HADOOP_HOME/share/hadoop/common/lib
cp $CHUKWA_HOME/etc/chukwa/hbase-log4j.properties $HBASE_CONF_DIR/log4j.properties
cp $CHUKWA_HOME/etc/chukwa/hadoop-metrics2-hbase.properties $HBASE_CONF_DIR/hadoop-metrics2-hbase.properties
cp $CHUKWA_HOME/share/chukwa/chukwa-${VERSION}-client.jar $HBASE_HOME/lib
cp $CHUKWA_HOME/share/chukwa/lib/json-simple-${json-simpleVersion}.jar $HBASE_HOME/lib
---  

  [[2]] Restart your Hadoop Cluster. General Hadoop configuration is available at: {{{http://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-common/ClusterSetup.html}Hadoop Configuration}}. <<N.B.>> You may see some additional logging messages at this stage which looks as if error(s) are present. These messages are showing up because the log4j socket appender writes to stderr for warn messages when it is unable to stream logs to a log4j socket server. If Apache Chukwa agent is started with socket adaptors prior to Hadoop and HBase, those messages will not show up. For the time being do not worry about these messages, they will disappear once Apache Chukwa agent is started with socket adaptors.
  
  [[3]] Make sure HBase is started. General HBASE configuration is available at: {{{http://hbase.apache.org/book.html#configuration}HBase Configuration}}
  
  [[4]] After Hadoop and HBase are started, run:

---
bin/hbase shell < $CHUKWA_HOME/etc/chukwa/hbase.schema
---

  This procedure initializes the default Apache Chukwa HBase schema.

* Configuring And Starting Apache Chukwa Agent

  [[1]] Edit CHUKWA_HOME/etc/chukwa/chukwa-env.sh. Make sure that JAVA_HOME, HADOOP_CONF_DIR, and HBASE_CONF_DIR are set correctly.

  [[2]] Edit CHUKWA_HOME/etc/chukwa/chukwa-agent-conf.xml. Make sure that solr.cloud.address are set correctly.

  [[3]] In CHUKWA_HOME, run:

---
sbin/chukwa-daemon.sh start agent
---

* Setup Solr to index Service log files

  [[1]] Start Solr ${solrVersion} with Apache Chukwa Solr configuration:

---
bin/solr start -cloud -z localhost:2181
./bin/solr create_collection -c chukwa -n chukwa
---

* Start HICC

  The Hadoop Infrastructure Care Center (HICC) is Apache Chukwa web user interface. 

  [[1]] To start HICC, do the following:

---
sbin/chukwa-daemon.sh start hicc
---

* Data Visualization

  [[1]] Once the webcontainer with HICC has been started, point your favorite browser to:

---
http://<server>:4080/hicc/
---
  
  [[2]] The default user name and password is "admin" without quotes.
  
  [[3]] Metrics data collected by Apache Chukwa Agent will be browsable through Graph Explorer widget.
